# API –¥–ª—è –û–±—Ä–æ–±–∫–∏ –ú–µ–¥—ñ–∞—Ñ–∞–π–ª—ñ–≤

–¶–µ–π –ø—Ä–æ—î–∫—Ç —î API-—Å–µ—Ä–≤—ñ—Å–æ–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –¥—ñ–∞—Ä–∏–∑–∞—Ü—ñ—ó (—Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Å–ø—ñ–∫–µ—Ä—ñ–≤) —Ç–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—ó (–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–≤–∏ –≤ —Ç–µ–∫—Å—Ç) –∞—É–¥—ñ–æ —Ç–∞ –≤—ñ–¥–µ–æ.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

-   **–°–µ—Ä–≤–µ—Ä:** Flask
-   **–§–æ–Ω–æ–≤—ñ –∑–∞–¥–∞—á—ñ:** Redis + RQ (Redis Queue)
-   **–î—ñ–∞—Ä–∏–∑–∞—Ü—ñ—è:** `pyannote
-   **–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—è:** Google Cloud Speech-to-Text
-   **–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö:** Firebase (Firestore, Storage)
-   **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è:** FFMPEG

---

## üõ†Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

-   **Python 3.9+**
-   **FFMPEG:** –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `ffmpeg` —É –≤–∞—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ.
    -   **Ubuntu/Debian:** `sudo apt update && sudo apt install ffmpeg`
    -   **macOS (Homebrew):** `brew install ffmpeg`

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1.  **–ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:**
    ```bash
    git clone <repository_url>
    cd video-transcript
    ```

2.  **–°—Ç–≤–æ—Ä—ñ—Ç—å –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

3.  **–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:**
    ```bash
    pip install -r requirements.txt
    ```

### 3. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

1.  **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env`** —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∑–º—ñ–Ω–Ω—ñ:

    ```env
    # –î–æ—Å—Ç—É–ø –¥–æ Google Cloud —Ç–∞ Firebase
    GOOGLE_APPLICATION_CREDENTIALS=service_account.json
    FIREBASE_CREDENTIALS_PATH=service_account.json
    FIREBASE_STORAGE_BUCKET=your-bucket-name.appspot.com

    # URL –≤–∞—à–æ–≥–æ Redis
    REDIS_URL=redis://localhost:6379

    # –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –¥–æ Hugging Face
    HUGGING_FACE_TOKEN=your_hugging_face_token
    ```

2.  **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —É Hugging Face:**
    ```bash
    huggingface-cli login
    ```

3.  **–ü—Ä–∏–π–º—ñ—Ç—å —É–º–æ–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ:**
    -   [pyannote/speaker-diarization](https://huggingface.co/pyannote/speaker-diarization)

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

–î–ª—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –≤–æ—Ä–∫–µ—Ä–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑ **–∫–æ—Ä–µ–Ω–µ–≤–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ—î–∫—Ç—É**:

```bash
# –ê–∫—Ç–∏–≤—É–π—Ç–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
# source venv/bin/activate

python3 -m src.app
```

**–í–∞–∂–ª–∏–≤–æ:** –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `python3 -m src.app` —î –∫—Ä–∏—Ç–∏—á–Ω–∏–º –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —ñ–º–ø–æ—Ä—Ç—ñ–≤.

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://localhost:5012`.

---

## ‚öôÔ∏è –í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ –¥—ñ–∞—Ä–∏–∑–∞—Ü—ñ—ó

–ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ª–µ–≥–∫–æ –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–¥–µ–ª—å, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥—ñ–∞—Ä–∏–∑–∞—Ü—ñ—ó, —â–æ–± –∑–Ω–∞–π—Ç–∏ –±–∞–ª–∞–Ω—Å –º—ñ–∂ —à–≤–∏–¥–∫—ñ—Å—Ç—é —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—é.

1.  **–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª:** `src/core/diarization.py`
2.  **–ó–Ω–∞–π—Ç–∏ —Ä—è–¥–æ–∫** –∑ `Pipeline.from_pretrained(...)`.
3.  **–ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞–∑–≤—É –º–æ–¥–µ–ª—ñ** –Ω–∞ –æ–¥–Ω—É –∑ –Ω–∞–≤–µ–¥–µ–Ω–∏—Ö –Ω–∏–∂—á–µ.

#### –î–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ:

-   `pyannote/speaker-diarization@2.1`
    -   **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –í–∏—Å–æ–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è CPU).
    -   **–¢–æ—á–Ω—ñ—Å—Ç—å:** –î–æ–±—Ä–∞.
    -   **–ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–∏ —É–º–æ–≤–∏:**
        -   [pyannote/speaker-diarization](https://huggingface.co/pyannote/speaker-diarization)
        -   [pyannote/segmentation](https://huggingface.co/pyannote/segmentation)

-   `pyannote/speaker-diarization-3.1`
    -   **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –ù–∏–∑—å–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ **—Ç—ñ–ª—å–∫–∏** –¥–ª—è GPU).
    -   **–¢–æ—á–Ω—ñ—Å—Ç—å:** –î—É–∂–µ –≤–∏—Å–æ–∫–∞.
    -   **–ù–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–π–Ω—è—Ç–∏ —É–º–æ–≤–∏:**
        -   [pyannote/speaker-diarization-3.1](https://huggingface.co/pyannote/speaker-diarization-3.1)
        -   [pyannote/segmentation-3.0](https://huggingface.co/pyannote/segmentation-3.0)

**–í–∞–∂–ª–∏–≤–æ:** –ü–µ—Ä–µ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –Ω–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —É–º–æ–≤–∏ —ó—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (—Ç–∞ —ó—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π) –ø—Ä–∏–π–Ω—è—Ç—ñ –Ω–∞ —Å–∞–π—Ç—ñ Hugging Face.

---

## üîå API


### –ó–∞–ø—É—Å–∫ –æ–±—Ä–æ–±–∫–∏

-   **–ï–Ω–¥–ø–æ—ñ–Ω—Ç:** `POST /api/transcribe`
-   **–û–ø–∏—Å:** –Ü–Ω—ñ—Ü—ñ—é—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –æ–±—Ä–æ–±–∫—É –º–µ–¥—ñ–∞—Ñ–∞–π–ª—É.

-   **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API –∫–ª—é—á–∞:**
    > C–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ª–∏—à–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–ª—è `api_key` —É –∑–∞–ø–∏—Ç—ñ. –í–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –∫–ª—é—á–∞ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è. –Ø–∫—â–æ –∫–ª—é—á –≤—ñ–¥—Å—É—Ç–Ω—ñ–π, –∑–∞–ø–∏—Ç –±—É–¥–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ –∑ –ø–æ–º–∏–ª–∫–æ—é 401.

-   **–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É (JSON):**
    ```json
    {
      "media_url": "gs://your-bucket/path/to/file.mp4",
      "firestore_ref": "collection_name/document_id",
      "language": "en-US",
      "api_key": "your_api_key"
    }
    ```

-   **–í—ñ–¥–ø–æ–≤—ñ–¥—å (202):**
    ```json
    {
      "message": "Processing started"
    }
    ```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É

-   **–ï–Ω–¥–ø–æ—ñ–Ω—Ç:** `GET /api/health`
-   **–û–ø–∏—Å:** –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞–Ω —á–µ—Ä–≥–∏ –∑–∞–≤–¥–∞–Ω—å.